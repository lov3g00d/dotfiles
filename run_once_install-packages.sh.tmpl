#!/bin/bash

# Package installation script for Arch Linux
echo "🚀 Installing essential packages..."

# Update system first
sudo pacman -Syu --noconfirm

# Core development tools
CORE_PACKAGES=(
    "git"
    "tmux" 
    "neovim"
    "zsh"
    "curl"
    "wget"
    "base-devel"
)

# Terminal emulators and tools
TERMINAL_PACKAGES=(
    "alacritty"
    "kitty"
    "btop"
    "redshift"
)

# Window manager and desktop utilities  
WM_PACKAGES=(
    "i3-wm"
    "i3status"
    "i3lock"
    "polybar"
    "rofi" 
    "dunst"
    "picom"
    "nitrogen"
)

# Development tools
DEV_PACKAGES=(
    "nodejs"
    "npm"
    "docker"
    "docker-compose"
    "kubectl"
    "helm"
    "go"
)

# Install core packages
echo "📦 Installing core packages..."
sudo pacman -S --needed --noconfirm "${CORE_PACKAGES[@]}"

echo "🖥️  Installing terminal packages..."  
sudo pacman -S --needed --noconfirm "${TERMINAL_PACKAGES[@]}"

echo "🪟 Installing window manager packages..."
sudo pacman -S --needed --noconfirm "${WM_PACKAGES[@]}"

echo "⚡ Installing development packages..."
sudo pacman -S --needed --noconfirm "${DEV_PACKAGES[@]}"

# Install Oh My Zsh if not present
if [ ! -d "$HOME/.oh-my-zsh" ]; then
    echo "🐚 Installing Oh My Zsh..."
    sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
fi

# Install Powerlevel10k theme
if [ ! -d "$HOME/.oh-my-zsh/custom/themes/powerlevel10k" ]; then
    echo "⚡ Installing Powerlevel10k theme..."
    git clone --depth=1 https://github.com/romkatv/powerlevel10k.git $HOME/.oh-my-zsh/custom/themes/powerlevel10k
fi

# Install zsh plugins
ZSH_PLUGINS_DIR="$HOME/.oh-my-zsh/custom/plugins"
plugins=(
    "zsh-autosuggestions:https://github.com/zsh-users/zsh-autosuggestions"
    "zsh-syntax-highlighting:https://github.com/zsh-users/zsh-syntax-highlighting"
    "fast-syntax-highlighting:https://github.com/zdharma-continuum/fast-syntax-highlighting"
    "zsh-autocomplete:https://github.com/marlonrichert/zsh-autocomplete"
)

for plugin in "${plugins[@]}"; do
    plugin_name="${plugin%:*}"
    plugin_url="${plugin#*:}"
    
    if [ ! -d "$ZSH_PLUGINS_DIR/$plugin_name" ]; then
        echo "🔌 Installing $plugin_name..."
        git clone "$plugin_url" "$ZSH_PLUGINS_DIR/$plugin_name"
    fi
done

# Install TPM (Tmux Plugin Manager) if not present
if [ ! -d "$HOME/.tmux/plugins/tpm" ]; then
    echo "🔧 Installing Tmux Plugin Manager..."
    git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
fi

# Install yay (AUR helper) if not present
if ! command -v yay &> /dev/null; then
    echo "📥 Installing yay AUR helper..."
    cd /tmp
    git clone https://aur.archlinux.org/yay.git
    cd yay
    makepkg -si --noconfirm
    cd ~
fi

# AUR packages
AUR_PACKAGES=(
    "starship"
    "atuin"
    "lazygit"
    "lazydocker"
    "sesh"
)

echo "🌟 Installing AUR packages..."
yay -S --needed --noconfirm "${AUR_PACKAGES[@]}"

echo "✅ Package installation completed!"
echo "🔄 Please restart your shell or run 'exec zsh' to load new configurations"