#!/bin/bash

echo "⚙️  Setting up services and final configurations..."

# Change default shell to zsh if not already
if [ "$SHELL" != "/usr/bin/zsh" ]; then
    echo "🐚 Changing default shell to zsh..."
    chsh -s /usr/bin/zsh
fi

# Enable and start Docker service
echo "🐳 Setting up Docker service..."
sudo systemctl enable docker
sudo systemctl start docker

# Add user to docker group
sudo usermod -aG docker $USER

# Install Tmux plugins
if [ -f "$HOME/.tmux.conf" ] && [ -d "$HOME/.tmux/plugins/tpm" ]; then
    echo "🔧 Installing Tmux plugins..."
    ~/.tmux/plugins/tpm/bin/install_plugins
fi

# Setup Neovim
if command -v nvim &> /dev/null; then
    echo "📝 Setting up Neovim..."
    # Install lazy.nvim plugin manager if config exists
    if [ -f "$HOME/.config/nvim/init.lua" ]; then
        nvim --headless "+Lazy! sync" +qa
    fi
fi

# Create necessary directories
echo "📁 Creating necessary directories..."
mkdir -p ~/.local/bin
mkdir -p ~/.config
mkdir -p ~/.cache

# Set proper permissions
chmod +x ~/.local/bin/* 2>/dev/null || true

echo "✅ Services and configurations setup completed!"
echo "🔄 Please log out and log back in for group changes to take effect"